<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Märsta Karta</title>

    <!-- Byt ut gamla CDN mot din GitHub-hostade version -->
    <link rel="stylesheet" href="https://erikbj14.github.io/openlayers-host/ol/ol.css" />
    <script src="https://erikbj14.github.io/openlayers-host/ol/ol.js"></script>

    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
      }

      #map {
        width: 100%;
        height: 100%;
      }

      .ol-popup {
        position: absolute;
        background-color: white;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #cccccc;
        bottom: 12px;
        left: -50px;
        min-width: 180px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.3);
      }

      .ol-popup:after, .ol-popup:before {
        top: 100%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
      }

      .ol-popup:after {
        border-top-color: white;
        border-width: 10px;
        left: 48px;
        margin-left: -10px;
      }

      .ol-popup:before {
        border-top-color: #cccccc;
        border-width: 11px;
        left: 48px;
        margin-left: -11px;
      }
    </style>
  </head>

  <body>
    <div id="map" class="map"></div>
    <div id="popup" class="ol-popup"></div>

    <script>
      const map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          })
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([17.851, 59.621]), // Märsta
          zoom: 14
        })
      });

      // Skapa en markör
      const marker = new ol.Feature({
        geometry: new ol.geom.Point(ol.proj.fromLonLat([17.851, 59.621])),
        name: 'Märsta station'
      });

      marker.setStyle(new ol.style.Style({
        image: new ol.style.Icon({
          anchor: [0.5, 1],
          src: 'https://openlayers.org/en/v4.6.5/examples/data/icon.png',
          scale: 1
        })
      }));

      const vectorSource = new ol.source.Vector({
        features: [marker]
      });

      const markerLayer = new ol.layer.Vector({
        source: vectorSource
      });

      map.addLayer(markerLayer);

      // Popup-element
      const popup = document.getElementById('popup');
      const overlay = new ol.Overlay({
        element: popup,
        positioning: 'bottom-center',
        stopEvent: false,
        offset: [0, -40]
      });

      map.addOverlay(overlay);

      // Visa popup vid klick
      map.on('click', function (evt) {
        const feature = map.forEachFeatureAtPixel(evt.pixel, f => f);
        if (feature) {
          const coordinates = feature.getGeometry().getCoordinates();
          overlay.setPosition(coordinates);
          popup.innerHTML = `<strong>${feature.get('name')}</strong><br>Central punkt i Märsta.`;
        } else {
          overlay.setPosition(undefined);
        }
      });
    </script>
  </body>
</html>
